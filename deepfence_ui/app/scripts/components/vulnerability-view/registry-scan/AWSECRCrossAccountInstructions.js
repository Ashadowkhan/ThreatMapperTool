import React, { useEffect, useState } from 'react';

import { Field } from 'redux-form/immutable';

import { REGION_OPTIONS } from '../../../constants/dropdown-option-collection';
import DFSearchableSelectField from '../../common/multi-select/app-searchable-field';

export const AWSECRCrossAccountInstructions = ({
  AWSConsoleAccountId: accountId,
  AWSConsoleAccountIdError: error,
  formValuesIm,
  change
}) => {
  const [expanded, setExpanded] = useState(false);
  const region = formValuesIm.getIn(['non_secret', 'aws_region_name'], REGION_OPTIONS.options[0])?.value

  useEffect(() => {
    change('non_secret.aws_region_name', REGION_OPTIONS.options[0])
  }, []);

  return (
    <div>
      <div
        style={{
          cursor: 'pointer',
          marginBottom: 10,
          display: 'flex',
          alignItems: 'center',
        }}
      >
        <div
          style={{
            display: 'flex',
            alignItems: 'center',
            fontSize: 16,
            fontWeight: 'bold',
          }}
          onClick={() => setExpanded(!expanded)}
        >
          {expanded ? (
            <i className="fa fa-chevron-down" />
          ) : (
            <i className="fa fa-chevron-right" />
          )}
          &nbsp;&nbsp; <span>Cross-Account Setup</span>
          &nbsp;&nbsp;
        </div>
        <a
          href="https://community.deepfence.io/threatstryker/docs/operations/registry-scanning/"
          style={{
            fontSize: 14,
            fontWeight: 'normal',
          }}
          target="_blank"
          rel="noreferrer"
        >
          Know More
        </a>
      </div>
      {expanded ? (
        <>
          <div
            className="duration-container df-select-field"
            style={{
              marginBottom: 10,
              fontSize: 14,
              fontWeight: 'bold',
              marginLeft: 20
            }}
          >
            {/* eslint-disable-next-line jsx-a11y/label-has-associated-control */}
            <label>Select Region</label>
            <Field
              key="aws_region_name"
              name="non_secret.aws_region_name"
              component={DFSearchableSelectField}
              options={REGION_OPTIONS.options}
            />
          </div>
          <div style={{ marginBottom: 10, marginTop: 10, marginLeft: 20 }}>
            <div
              style={{
                margin: '10px 0',
                fontSize: 14,
              }}
            >
              <a
                href={`https://${region}.console.aws.amazon.com/cloudformation/home?region=${region}#/stacks/create/review?templateURL=https://deepfence-public.s3.amazonaws.com/cross-account-ecr/deepfence-ecr-role-setup.template&stackName=Deepfence-ECR-Role-Setup&param_AccountId=${accountId}`}
                target="_blank"
                rel="noreferrer"
              >
                Setup ECR Registry Account
              </a>
              <br />
              <a
                href={`https://${region}.console.aws.amazon.com/cloudformation/home?region=${region}#/stacks/create/review?templateURL=https://deepfence-public.s3.amazonaws.com/cross-account-ecr/deepfence-console-account-setup.template&stackName=Deepfence-Mgmt-Console-ECR-Setup`}
                target="_blank"
                rel="noreferrer"
              >
                Setup Deepfence Console Account
              </a>
            </div>
            {error ? (
              <div>
                <span className="error-message">{error}</span>
              </div>
            ) : null}
          </div>
        </>
      ) : null}
    </div>
  );
};
